From aa97362658422a130ca140f7933725d057cda52e Mon Sep 17 00:00:00 2001
From: Mark Ellis <mark@mpellis.org.uk>
Date: Mon, 30 Sep 2013 14:26:00 +0000
Subject: housekeeping: Optimise for "do nothing" when cleaning thumbnails

https://bugzilla.gnome.org/show_bug.cgi?id=625609
https://bugs.launchpad.net/ubuntu/+source/gnome-settings-daemon/+bug/505085
---
diff --git a/plugins/housekeeping/gsd-housekeeping-manager.c b/plugins/housekeeping/gsd-housekeeping-manager.c
index f51d520..6e0c25d 100644
--- a/plugins/housekeeping/gsd-housekeeping-manager.c
+++ b/plugins/housekeeping/gsd-housekeeping-manager.c
@@ -225,6 +225,13 @@ purge_thumbnail_cache (GsdHousekeepingManager *manager)
 
         g_debug ("housekeeping: checking thumbnail cache size and freshness");
 
+        purge_data.max_age = g_settings_get_int (manager->priv->settings, THUMB_AGE_KEY) * 24 * 60 * 60;
+        purge_data.max_size = g_settings_get_int (manager->priv->settings, THUMB_SIZE_KEY) * 1024 * 1024;
+
+        /* if both are set to -1, we don't need to read anything */
+        if ((purge_data.max_age < 0) && (purge_data.max_size < 0))
+                return;
+
         paths = get_thumbnail_dirs ();
         files = NULL;
         for (i = 0; paths[i] != NULL; i++)
@@ -234,8 +241,6 @@ purge_thumbnail_cache (GsdHousekeepingManager *manager)
         g_get_current_time (&current_time);
 
         purge_data.now = current_time.tv_sec;
-        purge_data.max_age = g_settings_get_int (manager->priv->settings, THUMB_AGE_KEY) * 24 * 60 * 60;
-        purge_data.max_size = g_settings_get_int (manager->priv->settings, THUMB_SIZE_KEY) * 1024 * 1024;
         purge_data.total_size = 0;
 
         if (purge_data.max_age >= 0)

